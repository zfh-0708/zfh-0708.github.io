<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>市场大亨 - 经济模拟经营游戏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --radius: 10px;
            --transition: all 0.3s ease;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        h1 {
            color: var(--primary);
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--secondary), var(--success));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .subtitle {
            color: var(--dark);
            opacity: 0.7;
            font-size: 1.1rem;
        }

        .game-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 900px) {
            .game-container {
                grid-template-columns: 1fr;
            }
        }

        .main-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2 i {
            color: var(--secondary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: var(--light);
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--secondary);
            margin: 5px 0;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--dark);
            opacity: 0.7;
        }

        .products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .products-table th {
            background: var(--primary);
            color: white;
            padding: 12px;
            text-align: left;
        }

        .products-table td {
            padding: 12px;
            border-bottom: 1px solid var(--light);
        }

        .products-table tr:hover {
            background: var(--light);
        }

        .price {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .price-up {
            color: var(--success);
        }

        .price-down {
            color: var(--danger);
        }

        .price-stable {
            color: var(--warning);
        }

        .trend-indicator {
            display: inline-block;
            width: 0;
            height: 0;
            margin-left: 5px;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
        }

        .trend-up {
            border-bottom: 8px solid var(--success);
        }

        .trend-down {
            border-top: 8px solid var(--danger);
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .input-group input {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--light);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--secondary);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #219653;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            padding: 10px;
            margin: 8px 0;
            background: var(--light);
            border-radius: 6px;
            border-left: 4px solid var(--secondary);
        }

        .history-item.success {
            border-left-color: var(--success);
        }

        .history-item.danger {
            border-left-color: var(--danger);
        }

        .history-item.warning {
            border-left-color: var(--warning);
        }

        .progress-bar {
            height: 8px;
            background: var(--light);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--success));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.error {
            border-left: 4px solid var(--danger);
        }

        .notification.info {
            border-left: 4px solid var(--secondary);
        }

        .day-counter {
            font-size: 1.2rem;
            color: var(--primary);
            font-weight: bold;
        }

        .inventory-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--light);
        }

        .inventory-item:last-child {
            border-bottom: none;
        }

        .inventory-name {
            font-weight: 500;
        }

        .inventory-qty {
            font-weight: bold;
            color: var(--secondary);
        }

        .inventory-value {
            color: var(--success);
            font-weight: 500;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .game-over {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }

        .game-over-content {
            background: white;
            padding: 40px;
            border-radius: var(--radius);
            text-align: center;
            max-width: 500px;
            width: 90%;
        }

        .game-over h2 {
            color: var(--danger);
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .game-over p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: var(--dark);
        }

        .achievement-badge {
            display: inline-block;
            background: var(--warning);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin: 5px;
        }

        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: var(--dark);
            opacity: 0.7;
            font-size: 0.9rem;
        }

        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            justify-content: center;
            align-items: center;
        }

        .settings-content {
            background: white;
            padding: 30px;
            border-radius: var(--radius);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .settings-content h2 {
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }

        .setting-item {
            margin: 20px 0;
        }

        .setting-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .setting-item input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--light);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .setting-item input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .setting-item .range-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
            color: var(--secondary);
            min-width: 80px;
        }

        .setting-item small {
            display: block;
            margin-top: 5px;
            color: var(--dark);
            opacity: 0.7;
            font-size: 0.85rem;
        }

        .settings-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        .settings-buttons .btn {
            flex: 1;
        }

        #settings-btn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            width: 100%;
            margin-bottom: 10px;
        }

        #settings-btn:hover {
            background: linear-gradient(135deg, #8e44ad, #732d91);
        }

        .news-container {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-top: 20px;
            box-shadow: var(--shadow);
            max-height: 400px;
            overflow-y: auto;
        }
        
        .news-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
        }
        
        .news-header h3 {
            color: var(--primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .news-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .news-filter-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .news-filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .news-filter-btn:hover:not(.active) {
            background: var(--light);
        }
        
        .news-item {
            padding: 15px;
            margin: 10px 0;
            background: var(--light);
            border-radius: 8px;
            border-left: 4px solid #3498db;
            transition: var(--transition);
        }
        
        .news-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .news-item.positive {
            border-left-color: var(--success);
        }
        
        .news-item.negative {
            border-left-color: var(--danger);
        }
        
        .news-item.rumor {
            border-left-color: var(--warning);
        }
        
        .news-item.neutral {
            border-left-color: #95a5a6;
        }
        
        .news-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .news-content {
            color: var(--dark);
            opacity: 0.8;
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .news-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #7f8c8d;
        }
        
        .news-credibility {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .credibility-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .credibility-high { background: var(--success); }
        .credibility-medium { background: var(--warning); }
        .credibility-low { background: var(--danger); }
        
        .news-time {
            font-style: italic;
        }
        
        .news-impact-tags {
            display: flex;
            gap: 5px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        
        .news-impact-tag {
            padding: 3px 8px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 10px;
            font-size: 0.75rem;
            color: var(--secondary);
        }
        
        .news-ticker {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--primary);
            color: white;
            padding: 8px 0;
            overflow: hidden;
            z-index: 1000;
        }
        
        .ticker-content {
            display: inline-block;
            white-space: nowrap;
            padding-left: 100%;
            animation: ticker 30s linear infinite;
        }
        
        .ticker-item {
            display: inline-block;
            margin-right: 50px;
            font-size: 0.9rem;
        }
        
        .ticker-item .price-change {
            font-weight: bold;
            margin-left: 5px;
        }
        
        .ticker-item .up { color: #2ecc71; }
        .ticker-item .down { color: #e74c3c; }
        
        @keyframes ticker {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        
        .news-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-left: 4px solid;
            border-radius: var(--radius);
            padding: 15px;
            width: 300px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            transform: translateX(350px);
            transition: transform 0.3s ease;
            z-index: 1001;
        }
        
        .news-notification.show {
            transform: translateX(0);
        }
        
        .news-notification.positive { border-left-color: var(--success); }
        .news-notification.negative { border-left-color: var(--danger); }
        .news-notification.urgent { border-left-color: var(--warning); }
        
        .quick-action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        
        .product-news {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(52, 152, 219, 0.05);
            border-radius: 8px;
            margin: 5px 0;
            border-left: 3px solid;
        }
        
        .product-news.up { border-left-color: var(--success); }
        .product-news.down { border-left-color: var(--danger); }
        
        .product-news-name {
            font-weight: 500;
        }
        
        .product-news-price {
            font-weight: bold;
        }
        
        .price-up { color: var(--success); }
        .price-down { color: var(--danger); }
        
        @media (max-width: 768px) {
            .news-container {
                margin-top: 10px;
            }
            
            .news-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .news-filters {
                width: 100%;
            }
            
            .quick-action-buttons {
                grid-template-columns: 1fr;
            }
            
            .news-notification {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chart-line"></i> 市场大亨</h1>
            <p class="subtitle">模拟经营游戏 - 低买高卖，成为市场主宰！</p>
        </header>

        <div class="game-container">
            <div class="main-panel">
                <div class="card">
                    <h2><i class="fas fa-user-tie"></i> 玩家状态</h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">现金</div>
                            <div class="stat-value" id="cash">¥10,000</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">总资产</div>
                            <div class="stat-value" id="total-assets">¥10,000</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">游戏天数</div>
                            <div class="day-counter" id="day">第 1 天</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">声望</div>
                            <div class="stat-value" id="reputation">50</div>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-bar" style="width: 10%;"></div>
                    </div>
                    <div style="text-align: center; margin-top: 10px; font-size: 0.9rem; color: var(--dark); opacity: 0.7;">
                        目标：¥100,000
                    </div>
                </div>

                <div class="card">
                    <h2><i class="fas fa-store"></i> 当前市场</h2>
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th>商品</th>
                                <th>当前价格</th>
                                <th>趋势</th>
                                <th>库存</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="market-table">
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <h2><i class="fas fa-warehouse"></i> 我的库存</h2>
                    <div id="inventory-list">
                    </div>
                    <div style="text-align: center; margin-top: 20px; color: var(--dark); opacity: 0.7; font-size: 0.9rem;">
                        总库存价值: <span id="inventory-value">¥0</span>
                    </div>
                </div>

                <div class="card">
                    <h2><i class="fas fa-history"></i> 交易记录</h2>
                    <div class="history-list" id="history-list">
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="card">
                    <h2><i class="fas fa-handshake"></i> 交易操作</h2>
                    <div id="trade-form">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">选择商品</label>
                            <select id="product-select" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 1rem;">
                            </select>
                        </div>
                        <div class="input-group">
                            <input type="number" id="trade-quantity" min="1" value="1" placeholder="数量">
                        </div>
                        <div style="margin: 15px 0; text-align: center;">
                            <div style="font-size: 1.1rem; margin-bottom: 5px;">预估总价: <span id="estimated-price">¥0</span></div>
                            <div style="font-size: 0.9rem; color: #7f8c8d;">可用现金: <span id="available-cash">¥10,000</span></div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-success" id="buy-btn">
                                <i class="fas fa-shopping-cart"></i> 买入
                            </button>
                            <button class="btn btn-danger" id="sell-btn">
                                <i class="fas fa-money-bill-wave"></i> 卖出
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2><i class="fas fa-newspaper"></i> 市场新闻</h2>
                    <div class="news-header">
                        <div class="news-filters">
                            <button class="news-filter-btn active" data-filter="all">全部</button>
                            <button class="news-filter-btn" data-filter="positive">利好</button>
                            <button class="news-filter-btn" data-filter="negative">利空</button>
                            <button class="news-filter-btn" data-filter="rumor">传闻</button>
                        </div>
                    </div>
                    <div class="news-container" id="news-container">
                    </div>
                    <div class="quick-action-buttons">
                        <button class="btn" id="analyze-market" style="background: #9b59b6; color: white;">
                            <i class="fas fa-chart-bar"></i> 市场分析
                        </button>
                        <button class="btn" id="trend-report" style="background: #1abc9c; color: white;">
                            <i class="fas fa-trend-up"></i> 趋势报告
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h2><i class="fas fa-bullhorn"></i> 市场事件</h2>
                    <div id="events-list">
                    </div>
                </div>

                <div class="card">
                    <h2><i class="fas fa-gamepad"></i> 游戏控制</h2>
                    <button class="btn btn-primary" id="next-day-btn" style="width: 100%; margin-bottom: 10px;">
                        <i class="fas fa-forward"></i> 进入下一天
                    </button>
                    <button class="btn" id="settings-btn" style="width: 100%; margin-bottom: 10px; background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white;">
                        <i class="fas fa-cog"></i> 游戏设置
                    </button>
                    <button class="btn" id="save-game-btn" style="width: 100%; margin-bottom: 10px; background: #95a5a6; color: white;">
                        <i class="fas fa-save"></i> 保存游戏
                    </button>
                    <button class="btn btn-danger" id="reset-game-btn" style="width: 100%;">
                        <i class="fas fa-redo"></i> 重新开始
                    </button>
                </div>

                <div class="card">
                    <h2><i class="fas fa-trophy"></i> 成就</h2>
                    <div id="achievements">
                        <span class="achievement-badge">新手商人</span>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>© 2023 市场大亨 - 经济模拟经营游戏 | 低买高卖，理性投资！</p>
        </footer>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-info-circle"></i>
        <div id="notification-message">消息内容</div>
    </div>

    <div class="game-over" id="game-over">
        <div class="game-over-content">
            <h2><i class="fas fa-skull-crossbones"></i> 游戏结束</h2>
            <p id="game-over-message">您的现金已用尽！</p>
            <button class="btn btn-primary" id="restart-btn">
                <i class="fas fa-play"></i> 重新开始游戏
            </button>
        </div>
    </div>

    <div class="settings-modal" id="settings-modal">
        <div class="settings-content">
            <h2><i class="fas fa-cog"></i> 游戏设置</h2>
            
            <div class="setting-item">
                <label for="initial-cash">初始现金设置</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="range" id="initial-cash-slider" min="1000" max="1000000" step="1000" value="10000" style="flex: 1;">
                    <span class="range-value">¥<span id="initial-cash-value">10,000</span></span>
                </div>
                <input type="number" id="initial-cash-input" min="1000" max="1000000" step="1000" value="10000" style="margin-top: 10px;">
                <small>设置范围：¥1,000 - ¥1,000,000 (可在游戏中随时调整)</small>
            </div>

            <div class="setting-item">
                <label for="target-amount">目标金额设置</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="range" id="target-amount-slider" min="10000" max="5000000" step="10000" value="100000" style="flex: 1;">
                    <span class="range-value">¥<span id="target-amount-value">100,000</span></span>
                </div>
                <input type="number" id="target-amount-input" min="10000" max="5000000" step="10000" value="100000" style="margin-top: 10px;">
                <small>设置范围：¥10,000 - ¥5,000,000 (成为市场大亨的目标金额)</small>
            </div>

            <div class="setting-item">
                <label for="game-speed">游戏速度 (每轮间隔秒数)</label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <input type="range" id="game-speed-slider" min="1" max="10" step="1" value="3" style="flex: 1;">
                    <span class="range-value"><span id="game-speed-value">3</span> 秒</span>
                </div>
                <small>调节进入下一天后价格变化的延迟时间 (1-10秒)</small>
            </div>

            <div class="setting-item">
                <label>
                    <input type="checkbox" id="auto-save">
                    自动保存游戏进度
                </label>
                <small>启用后，游戏进度会自动保存到浏览器本地存储</small>
            </div>

            <div class="setting-item">
                <label>
                    <input type="checkbox" id="sound-effects" checked>
                    启用音效
                </label>
                <small>交易、市场变化时播放提示音</small>
            </div>

            <div class="settings-buttons">
                <button class="btn btn-success" id="apply-settings">
                    <i class="fas fa-check"></i> 应用设置
                </button>
                <button class="btn btn-primary" id="apply-restart">
                    <i class="fas fa-redo"></i> 应用并重新开始
                </button>
                <button class="btn" id="close-settings" style="background: #95a5a6; color: white;">
                    <i class="fas fa-times"></i> 取消
                </button>
            </div>
        </div>
    </div>

    <div class="news-notification" id="news-notification">
        <div class="news-title" id="notification-title">
            <i class="fas fa-newspaper"></i> 突发新闻
        </div>
        <div class="news-content" id="notification-content">新闻内容</div>
        <div class="news-meta">
            <div class="news-credibility">
                <span>可信度:</span>
                <span class="credibility-dot credibility-high"></span>
                <span>高</span>
            </div>
            <div class="news-time" id="notification-time">刚刚</div>
        </div>
    </div>

    <div class="news-ticker" id="news-ticker">
        <div class="ticker-content" id="ticker-content">
        </div>
    </div>

    <script>
        // 游戏设置变量
        const gameSettings = {
            initialCash: localStorage.getItem('marketTycoon_initialCash') ? 
                        parseInt(localStorage.getItem('marketTycoon_initialCash')) : 10000,
            targetAmount: localStorage.getItem('marketTycoon_targetAmount') ? 
                         parseInt(localStorage.getItem('marketTycoon_targetAmount')) : 100000,
            gameSpeed: localStorage.getItem('marketTycoon_gameSpeed') ? 
                      parseInt(localStorage.getItem('marketTycoon_gameSpeed')) : 3,
            autoSave: localStorage.getItem('marketTycoon_autoSave') === 'true',
            soundEffects: localStorage.getItem('marketTycoon_soundEffects') !== 'false'
        };

        // 游戏状态变量
        const gameState = {
            cash: gameSettings.initialCash,
            day: 1,
            reputation: 50,
            inventory: {},
            totalValue: 0,
            history: [],
            achievements: ['newbie_trader'],
            marketEvents: []
        };

        // 商品数据
        const products = [
            { id: 'gold', name: '黄金', basePrice: 500, volatility: 0.15, icon: 'fa-gem' },
            { id: 'oil', name: '原油', basePrice: 100, volatility: 0.25, icon: 'fa-gas-pump' },
            { id: 'grain', name: '谷物', basePrice: 30, volatility: 0.2, icon: 'fa-wheat-awn' },
            { id: 'tech', name: '科技股', basePrice: 200, volatility: 0.3, icon: 'fa-microchip' },
            { id: 'real_estate', name: '房地产', basePrice: 800, volatility: 0.1, icon: 'fa-building' },
            { id: 'crypto', name: '加密货币', basePrice: 50, volatility: 0.4, icon: 'fa-bitcoin-sign' }
        ];

        // 市场事件
        const marketEvents = [
            { 
                name: '经济繁荣', 
                effect: { type: 'multiplier', value: 1.3, duration: 3 },
                description: '经济蓬勃发展，所有商品价格上涨30%！',
                icon: 'fa-chart-line',
                color: '#27ae60'
            },
            { 
                name: '经济衰退', 
                effect: { type: 'multiplier', value: 0.8, duration: 3 },
                description: '经济衰退，所有商品价格下跌20%',
                icon: 'fa-chart-line-down',
                color: '#e74c3c'
            },
            { 
                name: '黄金热潮', 
                effect: { type: 'specific', product: 'gold', multiplier: 1.5, duration: 2 },
                description: '黄金价格飙升50%！',
                icon: 'fa-gem',
                color: '#f39c12'
            },
            { 
                name: '原油危机', 
                effect: { type: 'specific', product: 'oil', multiplier: 1.8, duration: 2 },
                description: '原油供应紧张，价格上涨80%',
                icon: 'fa-gas-pump',
                color: '#e74c3c'
            },
            { 
                name: '科技突破', 
                effect: { type: 'specific', product: 'tech', multiplier: 1.6, duration: 3 },
                description: '科技行业重大突破，科技股大涨',
                icon: 'fa-microchip',
                color: '#3498db'
            }
        ];

        // 新闻数据库
        const newsDatabase = [
            {
                id: 'news_oil_discovery',
                title: '大型油田被发现',
                content: '地质学家在北部地区发现超大型油田，预计储量惊人，可能大幅增加全球原油供应。',
                type: 'positive',
                credibility: 0.8,
                impacts: ['oil'],
                effect: { product: 'oil', multiplier: 0.7, duration: 3 },
                triggerCondition: () => Math.random() < 0.1
            },
            {
                id: 'news_tech_breakthrough',
                title: '科技公司发布革命性产品',
                content: '领先科技公司宣布突破性技术创新，市场预计将带动整个科技板块增长。',
                type: 'positive',
                credibility: 0.9,
                impacts: ['tech'],
                effect: { product: 'tech', multiplier: 1.5, duration: 4 },
                triggerCondition: () => Math.random() < 0.15
            },
            {
                id: 'news_gold_demand',
                title: '央行增持黄金储备',
                content: '多个国家央行宣布将大幅增加黄金储备，作为避险资产配置。',
                type: 'positive',
                credibility: 0.85,
                impacts: ['gold'],
                effect: { product: 'gold', multiplier: 1.4, duration: 3 },
                triggerCondition: () => Math.random() < 0.12
            },
            {
                id: 'news_economic_recession',
                title: '经济衰退信号显现',
                content: '最新经济数据显示多个指标下滑，分析师警告可能出现经济衰退。',
                type: 'negative',
                credibility: 0.75,
                impacts: ['all'],
                effect: { type: 'multiplier', value: 0.85, duration: 5 },
                triggerCondition: () => Math.random() < 0.1
            },
            {
                id: 'news_real_estate_bubble',
                title: '房地产泡沫警告',
                content: '权威机构发布报告，警告部分地区房地产市场存在过热风险。',
                type: 'negative',
                credibility: 0.7,
                impacts: ['real_estate'],
                effect: { product: 'real_estate', multiplier: 0.8, duration: 4 },
                triggerCondition: () => Math.random() < 0.08
            },
            {
                id: 'news_crypto_regulation',
                title: '加密货币监管加强',
                content: '多国政府宣布将加强对加密货币的监管力度，可能影响市场流动性。',
                type: 'negative',
                credibility: 0.8,
                impacts: ['crypto'],
                effect: { product: 'crypto', multiplier: 0.6, duration: 3 },
                triggerCondition: () => Math.random() < 0.1
            },
            {
                id: 'rumor_grain_shortage',
                title: '传闻：主要产粮区遭遇灾害',
                content: '市场传闻称几个主要粮食产区遭遇极端天气，但官方尚未证实。',
                type: 'rumor',
                credibility: 0.4,
                impacts: ['grain'],
                effect: { product: 'grain', multiplier: 1.3, duration: 2 },
                triggerCondition: () => Math.random() < 0.2
            },
            {
                id: 'rumor_tech_merger',
                title: '内部消息：科技巨头考虑合并',
                content: '据匿名内部人士透露，两家科技巨头正在探讨合并可能性。',
                type: 'rumor',
                credibility: 0.3,
                impacts: ['tech'],
                effect: { product: 'tech', multiplier: 1.2, duration: 2 },
                triggerCondition: () => Math.random() < 0.25
            },
            {
                id: 'news_fed_meeting',
                title: '美联储即将召开利率会议',
                content: '市场密切关注即将召开的美联储会议，预期将讨论利率政策。',
                type: 'neutral',
                credibility: 0.95,
                impacts: ['all'],
                effect: { volatility: 1.5, duration: 2 },
                triggerCondition: () => gameState.day % 10 === 0
            },
            {
                id: 'news_seasonal_demand',
                title: '季节性需求变化预期',
                content: '分析指出，随着季节变化，部分商品需求将出现周期性调整。',
                type: 'neutral',
                credibility: 0.8,
                impacts: ['oil', 'grain'],
                effect: { seasonality: true, duration: 5 },
                triggerCondition: () => Math.random() < 0.15
            }
        ];

        // 新闻历史记录
        let newsHistory = [];
        let currentNewsFilter = 'all';

        // 初始化游戏
        function initGame() {
            // 使用设置中的初始现金
            gameState.cash = gameSettings.initialCash;
            
            // 初始化商品价格
            products.forEach(product => {
                product.currentPrice = product.basePrice;
                product.trend = 0;
                product.priceHistory = [product.basePrice];
            });

            // 初始化库存
            products.forEach(product => {
                gameState.inventory[product.id] = 0;
            });

            // 加载保存的游戏（如果开启自动保存）
            if (gameSettings.autoSave) {
                loadSavedGame();
            } else {
                // 初始事件
                addMarketEvent('欢迎来到市场大亨！开始您的交易之旅吧！', 'info');
                addMarketEvent('提示：关注价格趋势，低买高卖才能盈利！', 'info');
            }

            updateUI();
            loadSettings();
            
            // 生成初始新闻
            setTimeout(() => {
                generateDailyNews();
            }, 1000);
        }

        // 更新商品价格
        function updatePrices() {
            products.forEach(product => {
                const oldPrice = product.currentPrice;
                
                // 基础波动
                let changePercent = (Math.random() - 0.5) * 2 * product.volatility;
                
                // 市场事件影响
                gameState.marketEvents.forEach(event => {
                    if (event.effect.type === 'multiplier') {
                        changePercent += (event.effect.value - 1);
                    } else if (event.effect.type === 'specific' && event.effect.product === product.id) {
                        changePercent += (event.effect.multiplier - 1);
                    }
                });

                // 计算新价格
                const newPrice = Math.max(10, Math.round(oldPrice * (1 + changePercent)));
                
                // 更新趋势
                if (newPrice > oldPrice) {
                    product.trend = 1;
                } else if (newPrice < oldPrice) {
                    product.trend = -1;
                } else {
                    product.trend = 0;
                }
                
                product.currentPrice = newPrice;
                product.priceHistory.push(newPrice);
                
                // 保持价格历史长度
                if (product.priceHistory.length > 10) {
                    product.priceHistory.shift();
                }
            });

            // 更新市场事件持续时间
            gameState.marketEvents = gameState.marketEvents.filter(event => {
                if (event.effect.duration) {
                    event.effect.duration--;
                    return event.effect.duration > 0;
                }
                return true;
            });

            // 随机触发新事件
            if (Math.random() < 0.3) { // 30%概率触发事件
                const randomEvent = marketEvents[Math.floor(Math.random() * marketEvents.length)];
                gameState.marketEvents.push({...randomEvent});
                addMarketEvent(`市场事件: ${randomEvent.description}`, 'info');
            }
        }

        // 进入下一天
        function nextDay() {
            gameState.day++;
            generateDailyNews();
            updatePrices();
            updateUI();
            
            // 检查游戏结束条件
            if (gameState.cash <= 0 && calculateTotalAssets() <= 0) {
                endGame('您的现金和资产都已耗尽！');
            } else if (gameState.day > 365) {
                endGame('一年的交易期已结束！');
            }
        }

        // 计算总资产
        function calculateTotalAssets() {
            let inventoryValue = 0;
            products.forEach(product => {
                inventoryValue += gameState.inventory[product.id] * product.currentPrice;
            });
            gameState.totalValue = gameState.cash + inventoryValue;
            return gameState.totalValue;
        }

        // 买入商品
        function buyProduct(productId, quantity) {
            const product = products.find(p => p.id === productId);
            if (!product) return false;

            const totalCost = product.currentPrice * quantity;
            
            if (gameState.cash < totalCost) {
                showNotification('现金不足，无法完成交易！', 'error');
                return false;
            }

            gameState.cash -= totalCost;
            gameState.inventory[productId] += quantity;
            
            // 记录交易历史
            addToHistory(`买入 ${quantity} 单位${product.name}，单价 ¥${product.currentPrice}`, 'success');
            showNotification(`成功买入 ${quantity} 单位${product.name}！`, 'success');
            
            updateUI();
            checkAchievements();
            return true;
        }

        // 卖出商品
        function sellProduct(productId, quantity) {
            const product = products.find(p => p.id === productId);
            if (!product) return false;

            if (gameState.inventory[productId] < quantity) {
                showNotification('库存不足，无法卖出！', 'error');
                return false;
            }

            const totalValue = product.currentPrice * quantity;
            
            gameState.cash += totalValue;
            gameState.inventory[productId] -= quantity;
            
            // 记录交易历史
            addToHistory(`卖出 ${quantity} 单位${product.name}，单价 ¥${product.currentPrice}`, 'danger');
            showNotification(`成功卖出 ${quantity} 单位${product.name}！`, 'success');
            
            updateUI();
            checkAchievements();
            return true;
        }

        // 添加交易记录
        function addToHistory(message, type = 'info') {
            const historyItem = {
                message,
                type,
                day: gameState.day,
                timestamp: new Date().toLocaleTimeString()
            };
            
            gameState.history.unshift(historyItem);
            
            // 保持历史记录长度
            if (gameState.history.length > 20) {
                gameState.history.pop();
            }
        }

        // 添加市场事件
        function addMarketEvent(message, type = 'info') {
            const eventItem = {
                message,
                type,
                day: gameState.day
            };
            
            // 添加到事件列表
            const eventsList = document.getElementById('events-list');
            const eventElement = document.createElement('div');
            eventElement.className = `history-item ${type}`;
            eventElement.innerHTML = `
                <div style="font-weight: 500;">${message}</div>
                <div style="font-size: 0.8rem; color: #7f8c8d; margin-top: 5px;">第 ${gameState.day} 天</div>
            `;
            
            eventsList.insertBefore(eventElement, eventsList.firstChild);
            
            // 保持事件列表长度
            if (eventsList.children.length > 5) {
                eventsList.removeChild(eventsList.lastChild);
            }
        }

        // 检查成就
        function checkAchievements() {
            const totalAssets = calculateTotalAssets();
            
            // 检查成就
            if (totalAssets >= 50000 && !gameState.achievements.includes('wealthy_trader')) {
                gameState.achievements.push('wealthy_trader');
                showNotification('成就解锁：富有商人！', 'success');
            }
            
            if (totalAssets >= gameSettings.targetAmount && !gameState.achievements.includes('market_tycoon')) {
                gameState.achievements.push('market_tycoon');
                showNotification(`恭喜！您已达成 ¥${gameSettings.targetAmount.toLocaleString()} 的目标，成为真正的市场大亨！`, 'success');
                endGame(`恭喜！您已达成 ¥${gameSettings.targetAmount.toLocaleString()} 的目标，成为真正的市场大亨！`);
            }
            
            if (gameState.day >= 30 && !gameState.achievements.includes('seasoned_trader')) {
                gameState.achievements.push('seasoned_trader');
                showNotification('成就解锁：资深商人！', 'success');
            }
        }

        // 显示通知
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const messageElement = document.getElementById('notification-message');
            
            notification.className = `notification ${type} show`;
            messageElement.textContent = message;
            
            // 添加图标
            const icon = notification.querySelector('i');
            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle';
            } else {
                icon.className = 'fas fa-info-circle';
            }
            
            // 3秒后隐藏
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // 游戏结束
        function endGame(message) {
            const gameOver = document.getElementById('game-over');
            const gameOverMessage = document.getElementById('game-over-message');
            
            gameOverMessage.textContent = message;
            gameOver.style.display = 'flex';
        }

        // 重新开始游戏
        function restartGame() {
            // 使用设置中的初始现金
            gameState.cash = gameSettings.initialCash;
            gameState.day = 1;
            gameState.reputation = 50;
            gameState.history = [];
            gameState.achievements = ['newbie_trader'];
            gameState.marketEvents = [];
            
            // 重置库存
            products.forEach(product => {
                gameState.inventory[product.id] = 0;
            });
            
            // 重置价格
            products.forEach(product => {
                product.currentPrice = product.basePrice;
                product.trend = 0;
                product.priceHistory = [product.basePrice];
            });
            
            // 清空事件列表
            document.getElementById('events-list').innerHTML = '';
            document.getElementById('news-container').innerHTML = '';
            newsHistory = [];
            
            // 添加初始事件
            addMarketEvent('欢迎来到市场大亨！开始您的交易之旅吧！', 'info');
            addMarketEvent('提示：关注价格趋势，低买高卖才能盈利！', 'info');
            
            // 隐藏游戏结束弹窗
            document.getElementById('game-over').style.display = 'none';
            
            updateUI();
            
            // 清除自动保存
            localStorage.removeItem('marketTycoon_saveData');
            
            showNotification('游戏已重新开始！', 'success');
        }

        // 更新UI
        function updateUI() {
            // 更新现金显示
            document.getElementById('cash').textContent = `¥${gameState.cash.toLocaleString()}`;
            document.getElementById('available-cash').textContent = `¥${gameState.cash.toLocaleString()}`;
            
            // 更新总资产
            const totalAssets = calculateTotalAssets();
            document.getElementById('total-assets').textContent = `¥${totalAssets.toLocaleString()}`;
            
            // 更新天数
            document.getElementById('day').textContent = `第 ${gameState.day} 天`;
            
            // 更新进度条（使用设置的目标金额）
            const progress = Math.min(100, (totalAssets / gameSettings.targetAmount) * 100);
            document.getElementById('progress-bar').style.width = `${progress}%`;
            
            // 更新声望
            document.getElementById('reputation').textContent = gameState.reputation;
            
            // 更新市场表格
            const marketTable = document.getElementById('market-table');
            const productSelect = document.getElementById('product-select');
            
            marketTable.innerHTML = '';
            productSelect.innerHTML = '';
            
            products.forEach(product => {
                // 市场表格行
                const row = document.createElement('tr');
                
                // 趋势图标
                let trendIcon = '';
                if (product.trend === 1) {
                    trendIcon = '<i class="fas fa-arrow-up trend-indicator trend-up"></i>';
                } else if (product.trend === -1) {
                    trendIcon = '<i class="fas fa-arrow-down trend-indicator trend-down"></i>';
                } else {
                    trendIcon = '<i class="fas fa-minus" style="color: #f39c12;"></i>';
                }
                
                // 价格变化颜色
                const priceClass = product.trend === 1 ? 'price-up' : (product.trend === -1 ? 'price-down' : 'price-stable');
                
                row.innerHTML = `
                    <td><i class="fas ${product.icon}"></i> ${product.name}</td>
                    <td class="price ${priceClass}">¥${product.currentPrice.toLocaleString()}</td>
                    <td>${trendIcon}</td>
                    <td>${gameState.inventory[product.id]}</td>
                    <td>
                        <button class="btn btn-success btn-sm" onclick="quickBuy('${product.id}')" style="padding: 5px 10px; font-size: 0.9rem;">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="quickSell('${product.id}')" style="padding: 5px 10px; font-size: 0.9rem; margin-left: 5px;">
                            <i class="fas fa-minus"></i>
                        </button>
                    </td>
                `;
                
                marketTable.appendChild(row);
                
                // 商品选择选项
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = `${product.name} (¥${product.currentPrice})`;
                productSelect.appendChild(option);
            });
            
            // 更新库存列表
            const inventoryList = document.getElementById('inventory-list');
            inventoryList.innerHTML = '';
            
            let totalInventoryValue = 0;
            products.forEach(product => {
                const quantity = gameState.inventory[product.id];
                if (quantity > 0) {
                    const itemValue = quantity * product.currentPrice;
                    totalInventoryValue += itemValue;
                    
                    const item = document.createElement('div');
                    item.className = 'inventory-item';
                    item.innerHTML = `
                        <div class="inventory-name">
                            <i class="fas ${product.icon}"></i> ${product.name}
                        </div>
                        <div style="display: flex; gap: 20px;">
                            <div class="inventory-qty">${quantity} 单位</div>
                            <div class="inventory-value">¥${itemValue.toLocaleString()}</div>
                        </div>
                    `;
                    inventoryList.appendChild(item);
                }
            });
            
            if (totalInventoryValue === 0) {
                inventoryList.innerHTML = '<div style="text-align: center; color: #7f8c8d; padding: 20px;">库存为空</div>';
            }
            
            document.getElementById('inventory-value').textContent = `¥${totalInventoryValue.toLocaleString()}`;
            
            // 更新交易历史
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';
            
            gameState.history.forEach(record => {
                const historyItem = document.createElement('div');
                historyItem.className = `history-item ${record.type}`;
                historyItem.innerHTML = `
                    <div>${record.message}</div>
                    <div style="font-size: 0.8rem; color: #7f8c8d; margin-top: 5px;">
                        第 ${record.day} 天 · ${record.timestamp}
                    </div>
                `;
                historyList.appendChild(historyItem);
            });
            
            if (gameState.history.length === 0) {
                historyList.innerHTML = '<div style="text-align: center; color: #7f8c8d; padding: 20px;">暂无交易记录</div>';
            }
            
            // 更新成就显示
            const achievements = document.getElementById('achievements');
            achievements.innerHTML = '';
            
            const achievementMap = {
                'newbie_trader': '新手商人',
                'seasoned_trader': '资深商人',
                'wealthy_trader': '富有商人',
                'market_tycoon': '市场大亨'
            };
            
            gameState.achievements.forEach(achievement => {
                if (achievementMap[achievement]) {
                    const badge = document.createElement('span');
                    badge.className = 'achievement-badge';
                    badge.textContent = achievementMap[achievement];
                    achievements.appendChild(badge);
                }
            });
            
            // 更新预估价格
            updateEstimatedPrice();
            updateNewsDisplay();
            
            // 自动保存
            if (gameSettings.autoSave) {
                saveGameToStorage();
            }
        }

        // 快速买入
        function quickBuy(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                document.getElementById('product-select').value = productId;
                updateEstimatedPrice();
                document.getElementById('buy-btn').click();
            }
        }

        // 快速卖出
        function quickSell(productId) {
            const product = products.find(p => p.id === productId);
            if (product && gameState.inventory[productId] > 0) {
                document.getElementById('product-select').value = productId;
                updateEstimatedPrice();
                document.getElementById('sell-btn').click();
            }
        }

        // 更新预估价格
        function updateEstimatedPrice() {
            const productSelect = document.getElementById('product-select');
            const quantityInput = document.getElementById('trade-quantity');
            const estimatedPriceElement = document.getElementById('estimated-price');
            
            const productId = productSelect.value;
            const quantity = parseInt(quantityInput.value) || 1;
            
            if (productId) {
                const product = products.find(p => p.id === productId);
                if (product) {
                    const estimatedPrice = product.currentPrice * quantity;
                    estimatedPriceElement.textContent = `¥${estimatedPrice.toLocaleString()}`;
                }
            } else {
                estimatedPriceElement.textContent = '¥0';
            }
        }

        // 加载设置
        function loadSettings() {
            // 加载设置到UI
            document.getElementById('initial-cash-slider').value = gameSettings.initialCash;
            document.getElementById('initial-cash-input').value = gameSettings.initialCash;
            document.getElementById('initial-cash-value').textContent = gameSettings.initialCash.toLocaleString();
            
            document.getElementById('target-amount-slider').value = gameSettings.targetAmount;
            document.getElementById('target-amount-input').value = gameSettings.targetAmount;
            document.getElementById('target-amount-value').textContent = gameSettings.targetAmount.toLocaleString();
            
            document.getElementById('game-speed-slider').value = gameSettings.gameSpeed;
            document.getElementById('game-speed-value').textContent = gameSettings.gameSpeed;
            
            document.getElementById('auto-save').checked = gameSettings.autoSave;
            document.getElementById('sound-effects').checked = gameSettings.soundEffects;
        }

        // 保存设置
        function saveSettings() {
            // 从UI获取设置值
            gameSettings.initialCash = parseInt(document.getElementById('initial-cash-input').value);
            gameSettings.targetAmount = parseInt(document.getElementById('target-amount-input').value);
            gameSettings.gameSpeed = parseInt(document.getElementById('game-speed-slider').value);
            gameSettings.autoSave = document.getElementById('auto-save').checked;
            gameSettings.soundEffects = document.getElementById('sound-effects').checked;
            
            // 保存到本地存储
            localStorage.setItem('marketTycoon_initialCash', gameSettings.initialCash);
            localStorage.setItem('marketTycoon_targetAmount', gameSettings.targetAmount);
            localStorage.setItem('marketTycoon_gameSpeed', gameSettings.gameSpeed);
            localStorage.setItem('marketTycoon_autoSave', gameSettings.autoSave);
            localStorage.setItem('marketTycoon_soundEffects', gameSettings.soundEffects);
            
            showNotification('游戏设置已保存！', 'success');
        }

        // 应用设置
        function applySettings(restart = false) {
            saveSettings();
            
            // 更新游戏中的目标金额显示
            document.querySelector('#progress-bar').parentNode.nextElementSibling.innerHTML = 
                `目标：¥${gameSettings.targetAmount.toLocaleString()}`;
            
            // 重新计算进度条
            const progress = Math.min(100, (calculateTotalAssets() / gameSettings.targetAmount) * 100);
            document.getElementById('progress-bar').style.width = `${progress}%`;
            
            if (restart) {
                if (confirm('应用设置并重新开始游戏吗？当前进度将丢失。')) {
                    restartGame();
                }
            } else {
                // 更新当前现金显示（但不重置游戏）
                updateUI();
                showNotification('设置已应用！', 'success');
            }
        }

        // 保存游戏到本地存储
        function saveGameToStorage() {
            if (!gameSettings.autoSave) return;
            
            const saveData = {
                gameState: gameState,
                products: products.map(product => ({
                    id: product.id,
                    currentPrice: product.currentPrice,
                    trend: product.trend,
                    priceHistory: product.priceHistory
                })),
                newsHistory: newsHistory,
                timestamp: new Date().getTime()
            };
            
            localStorage.setItem('marketTycoon_saveData', JSON.stringify(saveData));
        }

        // 从本地存储加载游戏
        function loadSavedGame() {
            const saved = localStorage.getItem('marketTycoon_saveData');
            if (saved) {
                try {
                    const saveData = JSON.parse(saved);
                    
                    // 恢复游戏状态
                    Object.assign(gameState, saveData.gameState);
                    
                    // 恢复商品状态
                    saveData.products.forEach(savedProduct => {
                        const product = products.find(p => p.id === savedProduct.id);
                        if (product) {
                            product.currentPrice = savedProduct.currentPrice;
                            product.trend = savedProduct.trend;
                            product.priceHistory = savedProduct.priceHistory;
                        }
                    });
                    
                    // 恢复新闻历史
                    newsHistory = saveData.newsHistory || [];
                    
                    // 检查时间（可选：如果保存超过24小时，可以提示）
                    const savedTime = new Date(saveData.timestamp);
                    const currentTime = new Date();
                    const hoursDiff = (currentTime - savedTime) / (1000 * 60 * 60);
                    
                    if (hoursDiff < 24) {
                        addMarketEvent('已加载上次保存的游戏进度', 'info');
                    } else {
                        addMarketEvent('加载了较旧的游戏进度（超过24小时）', 'warning');
                    }
                    
                    updateNewsDisplay();
                    return true;
                } catch (e) {
                    console.error('加载游戏失败:', e);
                    addMarketEvent('欢迎来到市场大亨！开始您的交易之旅吧！', 'info');
                }
            }
            return false;
        }

        // 生成每日新闻
        function generateDailyNews() {
            const todayNews = [];
            
            // 检查每个新闻的触发条件
            newsDatabase.forEach(news => {
                if (news.triggerCondition()) {
                    const newsCopy = { ...news };
                    newsCopy.timestamp = new Date().toLocaleTimeString();
                    newsCopy.day = gameState.day;
                    
                    // 添加随机干扰 - 30%的概率新闻效果会相反
                    if (Math.random() < 0.3) {
                        newsCopy.isMisleading = true;
                        if (newsCopy.effect.multiplier) {
                            // 如果是正面新闻，可能变成负面，反之亦然
                            if (newsCopy.type === 'positive') {
                                newsCopy.effect.multiplier = 1 / newsCopy.effect.multiplier;
                                newsCopy.actualType = 'negative';
                            } else if (newsCopy.type === 'negative') {
                                newsCopy.effect.multiplier = 1 / newsCopy.effect.multiplier;
                                newsCopy.actualType = 'positive';
                            }
                        }
                    }
                    
                    // 添加新闻效果
                    applyNewsEffect(newsCopy);
                    
                    // 添加到今日新闻和历史
                    todayNews.push(newsCopy);
                    newsHistory.unshift(newsCopy);
                    
                    // 显示重要新闻通知
                    if (newsCopy.credibility > 0.7 || newsCopy.type === 'rumor') {
                        showNewsNotification(newsCopy);
                    }
                }
            });
            
            // 如果今天没有自动生成的新闻，生成一条随机价格变动的新闻
            if (todayNews.length === 0 && Math.random() < 0.7) {
                const randomProduct = products[Math.floor(Math.random() * products.length)];
                const isUp = Math.random() > 0.5;
                const changePercent = (Math.random() * 0.2 + 0.05) * (isUp ? 1 : -1);
                
                const priceNews = {
                    id: 'price_update_' + Date.now(),
                    title: `${randomProduct.name}价格${isUp ? '看涨' : '看跌'}信号`,
                    content: `技术分析显示${randomProduct.name}出现${isUp ? '强劲' : '疲软'}走势，${
                        isUp ? '多个指标显示买入信号' : '分析师建议谨慎持有'
                    }。`,
                    type: isUp ? 'positive' : 'negative',
                    credibility: 0.6 + Math.random() * 0.3,
                    impacts: [randomProduct.id],
                    effect: { 
                        product: randomProduct.id, 
                        multiplier: 1 + changePercent, 
                        duration: 2 
                    },
                    timestamp: new Date().toLocaleTimeString(),
                    day: gameState.day
                };
                
                todayNews.push(priceNews);
                newsHistory.unshift(priceNews);
            }
            
            // 限制历史记录长度
            if (newsHistory.length > 50) {
                newsHistory = newsHistory.slice(0, 50);
            }
            
            updateNewsDisplay();
            return todayNews;
        }

        // 应用新闻效果
        function applyNewsEffect(news) {
            if (news.effect) {
                if (news.effect.multiplier) {
                    // 商品特定效果
                    if (news.effect.product) {
                        const product = products.find(p => p.id === news.effect.product);
                        if (product) {
                            // 添加到市场事件
                            gameState.marketEvents.push({
                                name: `新闻影响: ${news.title}`,
                                effect: { 
                                    type: 'specific', 
                                    product: news.effect.product, 
                                    multiplier: news.effect.multiplier, 
                                    duration: news.effect.duration || 3 
                                },
                                description: news.content,
                                icon: 'fa-newspaper',
                                color: news.type === 'positive' ? '#27ae60' : 
                                       news.type === 'negative' ? '#e74c3c' : '#f39c12'
                            });
                        }
                    }
                    // 全局效果
                    else if (news.effect.type === 'multiplier') {
                        gameState.marketEvents.push({
                            name: `新闻影响: ${news.title}`,
                            effect: news.effect,
                            description: news.content,
                            icon: 'fa-newspaper',
                            color: '#3498db'
                        });
                    }
                }
                // 波动性增加
                else if (news.effect.volatility) {
                    // 全局增加波动性
                    products.forEach(product => {
                        product.volatility *= news.effect.volatility;
                        // 3天后恢复
                        setTimeout(() => {
                            product.volatility /= news.effect.volatility;
                        }, (news.effect.duration || 2) * 1000);
                    });
                }
            }
        }

        // 显示新闻通知
        function showNewsNotification(news) {
            const notification = document.getElementById('news-notification');
            const title = document.getElementById('notification-title');
            const content = document.getElementById('notification-content');
            const time = document.getElementById('notification-time');
            
            // 设置内容
            title.innerHTML = `<i class="fas fa-${getNewsIcon(news.type)}"></i> ${
                news.isMisleading ? '[误导性] ' : ''
            }${news.title}`;
            content.textContent = news.content;
            time.textContent = `${news.timestamp} · 第${news.day}天`;
            
            // 设置样式
            notification.className = `news-notification ${news.type}`;
            if (news.isMisleading) notification.classList.add('urgent');
            
            // 显示通知
            notification.classList.add('show');
            
            // 5秒后隐藏
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // 获取新闻图标
        function getNewsIcon(type) {
            switch(type) {
                case 'positive': return 'arrow-up';
                case 'negative': return 'arrow-down';
                case 'rumor': return 'comment-alt';
                default: return 'newspaper';
            }
        }

        // 更新新闻显示
        function updateNewsDisplay() {
            const container = document.getElementById('news-container');
            if (!container) return;
            
            // 过滤新闻
            let filteredNews = [...newsHistory];
            if (currentNewsFilter !== 'all') {
                filteredNews = filteredNews.filter(news => news.type === currentNewsFilter);
            }
            
            // 生成HTML
            let newsHTML = '';
            
            filteredNews.slice(0, 10).forEach(news => {
                const credibilityText = news.credibility > 0.7 ? '高' : 
                                      news.credibility > 0.4 ? '中' : '低';
                const credibilityClass = news.credibility > 0.7 ? 'high' : 
                                       news.credibility > 0.4 ? 'medium' : 'low';
                
                // 获取影响标签
                let impactTags = '';
                if (news.impacts && news.impacts.length > 0) {
                    if (news.impacts[0] === 'all') {
                        impactTags = '<span class="news-impact-tag">全市场</span>';
                    } else {
                        news.impacts.forEach(impact => {
                            const product = products.find(p => p.id === impact);
                            if (product) {
                                impactTags += `<span class="news-impact-tag">${product.name}</span>`;
                            }
                        });
                    }
                }
                
                newsHTML += `
                    <div class="news-item ${news.type} ${news.isMisleading ? 'rumor' : ''}">
                        <div class="news-title">
                            <i class="fas fa-${getNewsIcon(news.type)}"></i>
                            ${news.title}
                            ${news.isMisleading ? '<span style="color:#e74c3c; fon
